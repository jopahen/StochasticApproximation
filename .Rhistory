frac <- g(ISample, K = K, r = r, T = T) * lratio_vectorized(ISample[,-1], S_0 = S_0, r = r, r_IS = r_IS, sigma = sigma, T = T)
#frac <- g(ISample, K = K, r = r, T = T) * p_vectorized(ISample[,-1], S_0 = S_0, r = r, sigma = sigma, T = T) / p_vectorized(ISample[,-1], S_0 = S_0, r = r_IS, sigma = sigma, T = T)
price <- mean(frac)
se <- sd(frac)
price_CI_lower <- price - qnorm(0.975) * se / sqrt(N)
price_CI_upper <- price + qnorm(0.975) * se / sqrt(N)
return(list(price = price, CI_lower = price_CI_lower,
CI_upper = price_CI_upper, se = se))
}
test1 <- Put_Asian_pricer()
test2 <- Put_Asian_pricer_IS()
test2 <- Put_Asian_pricer_IS(r_IS = 0.05)
rs <- seq(0,2,0.1)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(0,3,0.1)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(0,5,0.1)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
S_test <- S_path(100000)
S_test <- S_path(100)
S_test1 <- S_test[,-1]
lratio_vectorized(S_test1, r_IS = 1)
g(S_test)
#drift-shift likelihood ratio (single path vector)
lratio <- function(x, S_0 = 100, r = 0.05, r_IS = 0.1, sigma = 0.1, T = 0.2){
m <- length(x)
dt <- T/m
x_end <- x[length(x)]
out <- exp(-(r_IS-r) * (2 * log(x_end/S_0) - m * dt * (r + r_IS - sigma^2))
/ (2 * sigma^2))
return(out)
}
#drift-shift likelihood ratio (vectorized)
lratio_vectorized <- function(X, S_0 = 100, r = 0.05, r_IS = 0.1, sigma = 0.1,
T = 0.2){
if(is.null(dim(X))) return(as.numeric(lapply(X, lratio, S_0 = S_0, r = r,
r_IS = r_IS, sigma = sigma, T = T)))
return(apply(X, 1, lratio, S_0 = S_0, r = r, r_IS = r_IS, sigma = sigma, T = T))
}
S_test <- S_path(100)
S_test1 <- S_test[,-1]
lratio_vectorized(S_test1, r_IS = 1)
g(S_test)
Put_Asian_pricer_IS <- function(N = 10^4, S_0 = 100, r = 0.05, r_IS = 0.1,
sigma = 0.815, K = 120, T = 0.2){
ISample <- S_path(N, S_0 = S_0, r = r_IS, sigma = sigma, T = T)
frac <- g(ISample, K = K, r = r, T = T) * lratio_vectorized(ISample[,-1], S_0 = S_0, r = r, r_IS = r_IS, sigma = sigma, T = T)
#frac <- g(ISample, K = K, r = r, T = T) * p_vectorized(ISample[,-1], S_0 = S_0, r = r, sigma = sigma, T = T) / p_vectorized(ISample[,-1], S_0 = S_0, r = r_IS, sigma = sigma, T = T)
price <- mean(frac)
se <- sd(frac)
price_CI_lower <- price - qnorm(0.975) * se / sqrt(N)
price_CI_upper <- price + qnorm(0.975) * se / sqrt(N)
return(list(price = price, CI_lower = price_CI_lower,
CI_upper = price_CI_upper, se = se))
}
test1 <- Put_Asian_pricer()
test2 <- Put_Asian_pricer_IS(r_IS = 0.05)
rs <- seq(0,5,0.1)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(0,1,0.1)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(0,1,0.05)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(0,0.1,0.0005)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
rs <- seq(0,0.1,0.005)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(0,0.1,0.002)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(-0.1,0.1,0.002)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(-0.3,0.3,0.01)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(-0.3,0.3,0.01)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(K = 150, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(0,0.7,0.01)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
Put_Asian_pricer <- function(N = 10^5, S_0 = 100, r = 0.05, sigma = 0.815,
K = 120, T = 0.2){
price <- mean(g(S_path(N, S_0 = S_0, r = r, sigma = sigma, T = T), K = K, r = r, T = T))
se <- sd(g(S_path(N, S_0 = S_0, r = r, sigma = sigma, T = T), K = K, r = r, T = T))
price_CI_lower <- price - qnorm(0.975) * se / sqrt(N)
price_CI_upper <- price + qnorm(0.975) * se / sqrt(N)
return(list(price = price, CI_lower = price_CI_lower,
CI_upper = price_CI_upper, se = se))
}
Put_Asian_pricer_IS <- function(N = 10^5, S_0 = 100, r = 0.05, r_IS = 0.1,
sigma = 0.815, K = 120, T = 0.2){
ISample <- S_path(N, S_0 = S_0, r = r_IS, sigma = sigma, T = T)
frac <- g(ISample, K = K, r = r, T = T) * lratio_vectorized(ISample[,-1], S_0 = S_0, r = r, r_IS = r_IS, sigma = sigma, T = T)
#frac <- g(ISample, K = K, r = r, T = T) * p_vectorized(ISample[,-1], S_0 = S_0, r = r, sigma = sigma, T = T) / p_vectorized(ISample[,-1], S_0 = S_0, r = r_IS, sigma = sigma, T = T)
price <- mean(frac)
se <- sd(frac)
price_CI_lower <- price - qnorm(0.975) * se / sqrt(N)
price_CI_upper <- price + qnorm(0.975) * se / sqrt(N)
return(list(price = price, CI_lower = price_CI_lower,
CI_upper = price_CI_upper, se = se))
}
test1 <- Put_Asian_pricer()
test2 <- Put_Asian_pricer_IS(r_IS = 0)
rs <- seq(0,0.7,0.05)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(0,0.3,0.01)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
RM_IV_Asian <- function(n = 1000, N = 1000, I = 22, sigma_0 = 1, alpha_0 = 2/(120+100),
rho = 1, K = 120, batch_sd = 70, sd_monitor = FALSE){
sigma <- sigma_0
sigma_new <- sigma - alpha_0 * (mean(g(S_path(N, sigma = sigma), K = K)) - I)
sigmas <- sigma_new
batch_sds <- c()
iter <- 0
err <- abs(sigma_new - sigma)
while(iter < n){
sigma <- sigma_new
alpha <- alpha_0 / (iter+1)^rho
sigma_new <- sigma - alpha_0 * (mean(g(S_path(N, sigma = sigma), K = K)) - I)
sigmas <- c(sigmas, sigma_new)
err <- abs(sigma_new - sigma)
iter <- iter + 1
if(iter > batch_sd){
batch_sds <- c(batch_sds, sd(sigmas[(iter - batch_sd):iter]))
}
if(length(batch_sds) > 1 & sd_monitor){
if(batch_sds[length(batch_sds)] > batch_sds[length(batch_sds)-1]) break
}
#print(iter)
}
return(list(sigma = sigma_new, sigmas = sigmas, batch_sds = batch_sds))
}
#tic()
sigma_IV_RM_Asian <- RM_IV_Asian(sd_monitor = TRUE)
#x <- toc()
plot(sigma_IV_RM_Asian$sigmas)
plot(sigma_IV_RM_Asian$batch_sds, type = "l")
Put_Asian_pricer(sigma = sigma_IV_RM_Asian$sigma)
test1 <- Put_Asian_pricer()
test2 <- Put_Asian_pricer_IS(r_IS = 0)
test1 <- Put_Asian_pricer()
test2 <- Put_Asian_pricer_IS(r_IS = 0)
test2$CI_lower
test1 <- Put_Asian_pricer()
test2 <- Put_Asian_pricer_IS(r_IS = 0)
rs <- seq(0,0.3,0.01)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(sigma = 1, K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(-0.1,0.2,0.01)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(sigma = 1, K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
S_test <- S_path(100000)
S_test
S_test[,51]
mean(S_test[,51])
100*exp(0.05*0.2)
mean(S(100000))
mean(S(100000))
mean(S(100000))
mean(S(100000))
mean(S(100000))
mean(S(100000))
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
A <- matrix(c(1,1,1,1,1,1,1,1,1,1,1,1), nrow = 4)
A
c(1,2,3) * A
t(c(1,2,3)) * A
A <- matrix(c(1,1,1,1,1,1,1,1,1,1,1,1), nrow = 3)
c(1,2,3) * A
A <- matrix(c(1,1,1,1,1,1,1,1,1,1,1,1), nrow = 4)
A * c(1,2,3)
t(t(A) * c(1,2,3))
t(t(A) + c(1,2,3))
#price process simulation (path)
S_path <- function(N, m = 50, S_0 = 100, r = 0.05, sigma = 0.1,
T = 0.2){
dt <- T / m
t <- seq(0,T,dt)
X <- matrix(rnorm((m+1)*N, 0, sqrt(dt)), nrow = N)
X[,1] <- numeric(length = N)
X <- t(apply(X,1,cumsum))
S <- S_0 * exp(t((r-sigma^2/2) * t + t(sigma * X)))
return(S)
}
100*exp(0.05*0.2)
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S(100000))
mean(S(100000))
mean(S(100000))
mean(S(100000))
mean(S(100000))
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
mean(S_path(100000)[,51])
#We implement the RM-algorithm to find the IV with regard to the put option price
source("BS_functions.r")
RM_IV <- function(n = 1000, N = 100, I = 22, sigma_0 = 0.2, alpha_0 = 2/(120+100),
rho = 1){
sigma <- sigma_0
sigma_new <- sigma - alpha_0 * (mean(f(S(N, sigma = sigma))) - I)
iter <- 0
err <- abs(sigma_new - sigma)
while(iter < n){
sigma <- sigma_new
alpha <- alpha_0 / (iter+1)^rho
sigma_new <- sigma - alpha_0 * (mean(f(S(N, sigma = sigma))) - I)
err <- abs(sigma_new - sigma)
iter <- iter + 1
}
return(sigma_new)
}
#tic()
sigma_IV_RM_Asian <- RM_IV_Asian(sd_monitor = FALSE)
#x <- toc()
plot(sigma_IV_RM_Asian$sigmas)
plot(sigma_IV_RM_Asian$batch_sds, type = "l")
Put_Asian_pricer(sigma = sigma_IV_RM_Asian$sigma)
source("BS_functions.r")
RM_IV_Asian <- function(n = 1000, N = 1000, I = 22, sigma_0 = 1, alpha_0 = 2/(120+100),
rho = 1, K = 120, batch_sd = 70, sd_monitor = FALSE){
sigma <- sigma_0
sigma_new <- sigma - alpha_0 * (mean(g(S_path(N, sigma = sigma), K = K)) - I)
sigmas <- sigma_new
batch_sds <- c()
iter <- 0
err <- abs(sigma_new - sigma)
while(iter < n){
sigma <- sigma_new
alpha <- alpha_0 / (iter+1)^rho
sigma_new <- sigma - alpha_0 * (mean(g(S_path(N, sigma = sigma), K = K)) - I)
sigmas <- c(sigmas, sigma_new)
err <- abs(sigma_new - sigma)
iter <- iter + 1
if(iter > batch_sd){
batch_sds <- c(batch_sds, sd(sigmas[(iter - batch_sd):iter]))
}
if(length(batch_sds) > 1 & sd_monitor){
if(batch_sds[length(batch_sds)] > batch_sds[length(batch_sds)-1]) break
}
print(iter)
}
return(list(sigma = sigma_new, sigmas = sigmas, batch_sds = batch_sds))
}
#tic()
sigma_IV_RM_Asian <- RM_IV_Asian(sd_monitor = FALSE)
#x <- toc()
plot(sigma_IV_RM_Asian$sigmas)
#x <- toc()
plot(sigma_IV_RM_Asian$sigmas, type = "l")
plot(sigma_IV_RM_Asian$batch_sds, type = "l")
Put_Asian_pricer(sigma = sigma_IV_RM_Asian$sigma)
#tic()
sigma_IV_RM_Asian <- RM_IV_Asian(sd_monitor = TRUE)
#x <- toc()
plot(sigma_IV_RM_Asian$sigmas, type = "l")
plot(sigma_IV_RM_Asian$batch_sds, type = "l")
Put_Asian_pricer(sigma = sigma_IV_RM_Asian$sigma)
Put_Asian_pricer <- function(N = 10^5, S_0 = 100, r = 0.05, sigma = 0.8,
K = 120, T = 0.2){
price <- mean(g(S_path(N, S_0 = S_0, r = r, sigma = sigma, T = T), K = K, r = r, T = T))
se <- sd(g(S_path(N, S_0 = S_0, r = r, sigma = sigma, T = T), K = K, r = r, T = T))
price_CI_lower <- price - qnorm(0.975) * se / sqrt(N)
price_CI_upper <- price + qnorm(0.975) * se / sqrt(N)
return(list(price = price, CI_lower = price_CI_lower,
CI_upper = price_CI_upper, se = se))
}
Put_Asian_pricer_IS <- function(N = 10^5, S_0 = 100, r = 0.05, r_IS = 0.1,
sigma = 0.8, K = 120, T = 0.2){
ISample <- S_path(N, S_0 = S_0, r = r_IS, sigma = sigma, T = T)
frac <- g(ISample, K = K, r = r, T = T) * lratio_vectorized(ISample[,-1], S_0 = S_0, r = r, r_IS = r_IS, sigma = sigma, T = T)
#frac <- g(ISample, K = K, r = r, T = T) * p_vectorized(ISample[,-1], S_0 = S_0, r = r, sigma = sigma, T = T) / p_vectorized(ISample[,-1], S_0 = S_0, r = r_IS, sigma = sigma, T = T)
price <- mean(frac)
se <- sd(frac)
price_CI_lower <- price - qnorm(0.975) * se / sqrt(N)
price_CI_upper <- price + qnorm(0.975) * se / sqrt(N)
return(list(price = price, CI_lower = price_CI_lower,
CI_upper = price_CI_upper, se = se))
}
rs <- seq(-0.1,0.2,0.01)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(sigma = 1, K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(-2,2,0.1)
ses <- numeric(length = length(rs))
rs <- seq(-1,1,0.1)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(sigma = 1, K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(-2,2,0.2)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(sigma = 1, K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
rs <- seq(-3,1,0.2)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(sigma = 1, K = 120, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
test1 <- Put_Asian_pricer()
test1 <- Put_Asian_pricer(sigma = 1)
test2 <- Put_Asian_pricer_IS(sigma = 1, r_IS = -1)
rs <- seq(-3,1,0.2)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
test1 <- Put_Asian_pricer()
test2 <- Put_Asian_pricer_IS(r_IS = -1)
rs <- seq(-3,1,0.2)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(K = 150, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
test1 <- Put_Asian_pricer(K = 150)
test2 <- Put_Asian_pricer_IS(r_IS = -0.5)
rowMeans(S_test)
plot(density(rowMeans(S_test)))
plot(density(rowMeans(S_test1)))
S_test <- S_path(100000, sigma = 1)
S_test1 <- S_test[,-1]
plot(density(rowMeans(S_test1)))
S_test <- S_path(100000, r = -0.5, sigma = 1)
S_test1 <- S_test[,-1]
plot(density(rowMeans(S_test1)))
S_test <- S_path(100000, r = -0.5, sigma = 0.8)
S_test1 <- S_test[,-1]
plot(density(rowMeans(S_test1)))
S_test <- S_path(100000, r = 0.05, sigma = 0.8)
S_test1 <- S_test[,-1]
plot(density(rowMeans(S_test1)))
rs <- seq(-3,1,0.2)
ses <- numeric(length = length(rs))
prices <- numeric(length = length(rs))
for(i in 1:length(rs)){
Pricer <- Put_Asian_pricer_IS(K = 150, r_IS = rs[i])
ses[i] <- Pricer$se
prices[i] <- Pricer$price
}
plot(rs,ses, type = "l")
plot(rs,prices, type = "l")
